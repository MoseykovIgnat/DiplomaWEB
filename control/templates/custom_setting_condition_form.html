<form action="{% url 'condition_create' %}" method="post">
{% load crispy_forms_tags %}

{% csrf_token %}
 <div class="new_condition_form ">
{{ form|crispy }}
     <div class="col-6">
      </div>
</div>
</form>

{% block javascript %}


  <script>
  $(document).ready( function() {

    function split( val ) {
      return val.split( / \s*/ );
    }

    function extractLast( term ) {
      return split( term ).pop();
    }

    $( "#id_formula" )
      // don't navigate away from the field on tab when selecting an item
      .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete( "instance" )._renderItem = function( ul, item ) {
          return $( "<li>" )
            .append( "<div>" + "HIHIHI" + "<br>" + item.comment + "</div>" )
            .appendTo( ul );
        }
      .autocomplete({
        minLength: 1,
        {#source: function( request, response ) {#}
        {#  // delegate back to autocomplete, but extract the last term#}
        {#  response( $.ui.autocomplete.filter(#}
        {#    availableTags, extractLast( request.term ) ) );},#}
        source: function(request, response){
        $.ajax({
            type:'GET',
            url : "{% url 'search_info_for_autocomplete' %}",
            data:{
                maxRows: 100, // показать первые n результатов (Может быть и 1к но и
                nameStartsWith: extractLast(request.term), // поисковая фраза
            },
            success: function(data){
                response(data);
            }
        });
    },
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          // remove the current input
          terms.pop();
          // add the selected item
          terms.push( ui.item.value );
          // add placeholder to get the comma-and-space at the end
          terms.push("");
          this.value = terms.join(' ');
          lastItem = ui.item.value;
          return false;
        }
      });

        $( "#id_min_val" )
      // don't navigate away from the field on tab when selecting an item
      .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        minLength: 1,
        {#source: function( request, response ) {#}
        {#  // delegate back to autocomplete, but extract the last term#}
        {#  response( $.ui.autocomplete.filter(#}
        {#    availableTags, extractLast( request.term ) ) );},#}
        source: function(request, response){
        $.ajax({
            type:'GET',
            url : "{% url 'search_info_for_autocomplete' %}",
            data:{
                maxRows: 100, // показать первые n результатов (Может быть и 1к но и
                nameStartsWith: extractLast(request.term), // поисковая фраза
            },
            success: function(data){
                response(data);
            }
        });
    },
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          // remove the current input
          terms.pop();
          // add the selected item
          terms.push( ui.item.value );
          // add placeholder to get the comma-and-space at the end
          terms.push("");
          this.value = terms.join(' ');
          lastItem = ui.item.value;
          return false;
        }
      });

          $( "#id_max_val" )
      // don't navigate away from the field on tab when selecting an item
      .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        minLength: 1,
        {#source: function( request, response ) {#}
        {#  // delegate back to autocomplete, but extract the last term#}
        {#  response( $.ui.autocomplete.filter(#}
        {#    availableTags, extractLast( request.term ) ) );},#}
        source: function(request, response){
        $.ajax({
            type:'GET',
            url : "{% url 'search_info_for_autocomplete' %}",
            data:{
                maxRows: 100, // показать первые n результатов (Может быть и 1к но и
                nameStartsWith: extractLast(request.term), // поисковая фраза
            },
            success: function(data){
                response(data);
            }
        });
    },
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          // remove the current input
          terms.pop();
          // add the selected item
          terms.push( ui.item.value );
          // add placeholder to get the comma-and-space at the end
          terms.push("");
          this.value = terms.join(' ');
          lastItem = ui.item.value;
          return false;
        }
      });

          $( "#id_limit_val" )
      // don't navigate away from the field on tab when selecting an item
      .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        minLength: 1,
        {#source: function( request, response ) {#}
        {#  // delegate back to autocomplete, but extract the last term#}
        {#  response( $.ui.autocomplete.filter(#}
        {#    availableTags, extractLast( request.term ) ) );},#}
        source: function(request, response){
        $.ajax({
            type:'GET',
            url : "{% url 'search_info_for_autocomplete' %}",
            data:{
                maxRows: 100, // показать первые n результатов (Может быть и 1к но и
                nameStartsWith: extractLast(request.term), // поисковая фраза
            },
            success: function(data){
                response(data);
            }
        });
    },
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          // remove the current input
          terms.pop();
          // add the selected item
          terms.push( ui.item.value );
          // add placeholder to get the comma-and-space at the end
          terms.push("");
          this.value = terms.join(' ');
          lastItem = ui.item.value;
          return false;
        }
      });
  } );


  </script>

{#    <script>#}
{#     $(document).ready(function (){#}
{#      $('input#div_id_min_val').css("disabled","true");#}
{#      $('input#div_id_max_val').css("disabled","true");#}
{#      $('input#div_id_limit_val').css("disabled","true");#}
{#      $('input#div_id_priority').css("disabled","true");#}
{#      $('input#div_id_alert_interval').css("disabled","true");#}
{##}
{##}
{#    })#}
{#    </script>#}
{#    <script>#}
{#    $('#id_cond_type').on('change', function (){#}
{#        if (this.value == 2 || this.value == 3 || this.value == 4 || this.value == 5){#}
{#            $('#div_id_limit_val').css("disabled","false");#}
{#            $('#div_id_min_val').css("disabled","true");#}
{#            $('#div_id_max_val').css("disabled","true");#}
{#        }#}
{#        if (this.value == 6){#}
{#            $('#div_id_min_val').css("disabled","false");#}
{#            $('#div_id_max_val').css("disabled","false");#}
{#            $('#id_disabled_method').css("disabled","false");#}
{#            $('#div_id_limit_val').css("disabled","true");#}
{#        }#}
{#        if (this.value == 1){#}
{#            $('#div_id_min_val').css("disabled","true");#}
{#            $('#div_id_max_val').css("disabled","true");#}
{#            $('#div_id_limit_val').css("disabled","true");#}
{#        }#}
{#    });#}
{#    $('#id_disabled_method').on('change', function (){#}
{#        if (this.value == "Text+Siren"){#}
{#            $('#div_id_priority').css("disabled","false");#}
{#            $('#div_id_alert_interval').css("disabled","false");#}
{#        }#}
{#        if (this.value == "Text"){#}
{#            $('#div_id_priority').css("disabled","true");#}
{#            $('#div_id_alert_interval').css("disabled","true");#}
{#        }#}
{##}
{##}
{#    });#}
{#    </script>#}
{% endblock javascript %}